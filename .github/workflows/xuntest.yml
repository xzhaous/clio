name: Xun clio build
on:
  workflow_dispatch:
    inputs:
      release_deploy:
        description: "standard release no build"
        type: choice
        options:
        - "no"
        - "yes"
      branch:
        description: 'Branch'
        type: string
      commit:
        description: 'Commit ID'
        type: string
      release_tag:
        description: 'release tag'
        required: true
        type: string
      environment:
        description: 'evnvironment targeting'
        type: choice
        options:
        - prod
        - perf
        - dev
      clio_config_version:
        description: 'clio config version'
        type: string
      wait_for_clio_cache_full:
        description: 'wait for clio full cache'
        type: choice
        options:
        - "no"
        - "yes"
  
jobs:
  build_linux:
    name: Build linux
    runs-on: [self-hosted]
    env:
      CCACHE_DIR: /home/xzhao/.ccache
      CONAN_USER_HOME: /home/xzhao
    steps:
      - name: Get Clio
        uses: actions/checkout@v4
        with:
          ref: develop
          
      - name: Build Clio
        uses: ./.github/actions/testbuild

      - name: Deploy Clio 
        run: |
             cd /home/xzhao/deploy
             bash deployclioonly.sh newclioboxes /space/clio/clio/build/clio_server
